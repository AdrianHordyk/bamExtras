plot(year,SSB.msst,type="o")
plot(year,F.Fmsy,type="o")
})
# Chunk 6
spcol <- c("BS"="black","RP"="red")
par(mfrow=c(3,2),mar=c(2,2,1,1),mgp=c(1,0.2,0),tck=-0.01)
ylim <- range(c(0,rdat_BS$t.series$N,rdat_RP$t.series$N),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,N,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,N,type="o",col=spcol["RP"]))
legend("top",legend=c("Black Sea Bass","Red Porgy"),
pch=1,col=spcol,lty=1)
ylim <- range(c(0,rdat_BS$t.series$recruits,rdat_RP$t.series$recruits),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,recruits,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,recruits,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$SSB,rdat_RP$t.series$SSB),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,SSB,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,SSB,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$F.full,rdat_RP$t.series$F.full),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,F.full,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,F.full,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$SSB.msst,rdat_RP$t.series$SSB.msst),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,SSB.msst,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,SSB.msst,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$F.Fmsy,rdat_RP$t.series$F.Fmsy),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,F.Fmsy,type="o",col="black",ylim=ylim))
with(rdat_RP$t.series,points(year,F.Fmsy,type="o",col=spcol["RP"]))
# Chunk 7
bam_RP <- bam2r(dat_obj=dat_RedPorgy,tpl_obj=tpl_RedPorgy,cxx_obj=cxx_RedPorgy)
# Chunk 8
bam_RP <- bam2r("RedPorgy")
# Chunk 9
# Run a bam model and assign rdat output to object
#rdat_RP <- run_bam(bam=bam_RP,fileName="RP")
# Chunk 10
# Modify data input from a BAM model and incorporate it back into the dat file object
# L_init2 <- bam_RP$L_init
# L_init2$set_steep[c(1,5)] <- paste(0.6) # Change steepness
# L_init2$set_steep[4] <- paste(-abs(as.numeric(L_init2$set_steep[4]))) # Fix steepness
# bam_RP2 <- bam2r("RedPorgy",L_init_user=L_init2)
# rdat_RP2 <- run_bam(bam=bam_RP2,fileName="RP2")
# Chunk 11
# spcol <- c("RP"="black","RP2"="red")
#
# par(mfrow=c(3,2),mar=c(2,2,1,1),mgp=c(1,0.2,0),tck=-0.01)
# ylim <- range(c(0,rdat_RP$t.series$N,rdat_RP2$t.series$N),na.rm=TRUE)
# with(rdat_RP$t.series,plot(year,N,type="o",col=spcol["RP"],ylim=ylim))
# with(rdat_RP2$t.series,points(year,N,type="o",col=spcol["RP2"]))
#
# legend("top",legend=c("Black Sea Bass","Red Porgy"),
#        pch=1,col=spcol,lty=1)
#
# ylim <- range(c(0,rdat_RP$t.series$recruits,rdat_RP2$t.series$recruits),na.rm=TRUE)
# with(rdat_RP$t.series,plot(year,recruits,type="o",col=spcol["RP"],ylim=ylim))
# with(rdat_RP2$t.series,points(year,recruits,type="o",col=spcol["RP2"]))
#
# ylim <- range(c(0,rdat_RP$t.series$SSB,rdat_RP2$t.series$SSB),na.rm=TRUE)
# with(rdat_RP$t.series,plot(year,SSB,type="o",col=spcol["RP"],ylim=ylim))
# with(rdat_RP2$t.series,points(year,SSB,type="o",col=spcol["RP2"]))
#
# ylim <- range(c(0,rdat_RP$t.series$F.full,rdat_RP2$t.series$F.full),na.rm=TRUE)
# with(rdat_RP$t.series,plot(year,F.full,type="o",col=spcol["RP"],ylim=ylim))
# with(rdat_RP2$t.series,points(year,F.full,type="o",col=spcol["RP2"]))
#
# ylim <- range(c(0,rdat_RP$t.series$SSB.msst,rdat_RP2$t.series$SSB.msst),na.rm=TRUE)
# with(rdat_RP$t.series,plot(year,SSB.msst,type="o",col=spcol["RP"],ylim=ylim))
# with(rdat_RP2$t.series,points(year,SSB.msst,type="o",col=spcol["RP2"]))
#
# ylim <- range(c(0,rdat_RP$t.series$F.Fmsy,rdat_RP2$t.series$F.Fmsy),na.rm=TRUE)
# with(rdat_RP$t.series,plot(year,F.Fmsy,type="o",col="black",ylim=ylim))
# with(rdat_RP2$t.series,points(year,F.Fmsy,type="o",col=spcol["RP2"]))
# Chunk 12
# read in black ses bass age comps used in the recent stock assessment
rdat <- rdat_BlackSeaBass
comp <- rdat$comp.mats # List of composition matrices
acomp <- comp[grepl("^acomp.*.ob$",names(comp))] # list of observed age composition matrices
comp_i <- acomp$acomp.Mcvt.ob
cc_i <- catch_curve(comp_i)
# Plot comps and add catch curves (note the log-tranformation of the composition data)
comp_plot(log(comp_i),cc=cc_i,fillComp = FALSE,ylab= "log(proportion)",xlab="age",title="black sea bass commercial handline catch curves")
# Plot Z estimates over time for multiple sets of age compositions
par(mfrow=c(1,1),mgp=c(1,.2,0),mar=c(2,2,1,1),oma=c(0,0,0,0),tck=0.01)
M <- rdat$parms$M.msst
cc <- lapply(acomp,catch_curve)
abb <- gsub("^(acomp.)|(.ob)$","",names(cc)) # abbreviations of age composition fleets
cols <- rainbow(length(cc))
xlim <- range(unlist(lapply(cc,function(x){as.numeric(x$year)})),na.rm=TRUE)
ylim <- range(c(0,unlist(lapply(cc,function(x){-as.numeric(x$slope)}))),na.rm=TRUE)
for(i in 1:length(cc)){
xi <- cc[[i]]
year <- as.numeric(xi$year)
Z <- -xi$slope
if(i==1){
plot(year,Z,xlim=xlim,ylim=ylim,type="o",col=cols[i])
}else{
points(year,Z,type="o",col=cols[i])
}
}
# Add reference line for natural mortality
abline(h=M,lty=2,lwd=2)
text(par("usr")[1]+0.05*diff(par("usr")[1:2]),M,labels="M",pos=3)
legend("bottomleft",legend=abb,col=cols,pch=1,lty=1,bty="n")
# Chunk 1
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.width = 7,
fig.height = 7,
warning = FALSE,
errors = FALSE,
messages = FALSE
)
# Chunk 2
# Install and load package
#devtools::install_github("nikolaifish/bamExtras")
library(bamExtras)
# Load dependencies
library(stringr)
# Chunk 3
# see all data objects in bamExtras
data(package="bamExtras")$result[,"Item"]
# Chunk 4
rdat_BS <- standardize_rdat(rdat_BlackSeaBass)
rdat_RP <- standardize_rdat(rdat_RedPorgy)
# Chunk 5
par(mfrow=c(3,2),mar=c(2,2,1,1),mgp=c(1,0.2,0),tck=-0.01)
with(rdat_BS$t.series,{
plot(year,N,type="o")
plot(year,recruits,type="o")
plot(year,SSB,type="o")
plot(year,F.full,type="o")
plot(year,SSB.msst,type="o")
plot(year,F.Fmsy,type="o")
})
# Chunk 6
spcol <- c("BS"="black","RP"="red")
par(mfrow=c(3,2),mar=c(2,2,1,1),mgp=c(1,0.2,0),tck=-0.01)
ylim <- range(c(0,rdat_BS$t.series$N,rdat_RP$t.series$N),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,N,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,N,type="o",col=spcol["RP"]))
legend("top",legend=c("Black Sea Bass","Red Porgy"),
pch=1,col=spcol,lty=1)
ylim <- range(c(0,rdat_BS$t.series$recruits,rdat_RP$t.series$recruits),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,recruits,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,recruits,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$SSB,rdat_RP$t.series$SSB),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,SSB,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,SSB,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$F.full,rdat_RP$t.series$F.full),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,F.full,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,F.full,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$SSB.msst,rdat_RP$t.series$SSB.msst),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,SSB.msst,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,SSB.msst,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$F.Fmsy,rdat_RP$t.series$F.Fmsy),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,F.Fmsy,type="o",col="black",ylim=ylim))
with(rdat_RP$t.series,points(year,F.Fmsy,type="o",col=spcol["RP"]))
# Chunk 7
bam_RP <- bam2r(dat_obj=dat_RedPorgy,tpl_obj=tpl_RedPorgy,cxx_obj=cxx_RedPorgy)
# Chunk 8
bam_RP <- bam2r("RedPorgy")
# Chunk 9
# Run a bam model and assign rdat output to object
rdat_RP <- run_bam(bam=bam_RP,fileName="RP")
# Chunk 10
# Modify data input from a BAM model and incorporate it back into the dat file object
L_init2 <- bam_RP$L_init
L_init2$set_steep[c(1,5)] <- paste(0.6) # Change steepness
L_init2$set_steep[4] <- paste(-abs(as.numeric(L_init2$set_steep[4]))) # Fix steepness
bam_RP2 <- bam2r("RedPorgy",L_init_user=L_init2)
rdat_RP2 <- run_bam(bam=bam_RP2,fileName="RP2")
# Chunk 11
spcol <- c("RP"="black","RP2"="red")
par(mfrow=c(3,2),mar=c(2,2,1,1),mgp=c(1,0.2,0),tck=-0.01)
ylim <- range(c(0,rdat_RP$t.series$N,rdat_RP2$t.series$N),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,N,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,N,type="o",col=spcol["RP2"]))
legend("top",legend=c("Black Sea Bass","Red Porgy"),
pch=1,col=spcol,lty=1)
ylim <- range(c(0,rdat_RP$t.series$recruits,rdat_RP2$t.series$recruits),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,recruits,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,recruits,type="o",col=spcol["RP2"]))
ylim <- range(c(0,rdat_RP$t.series$SSB,rdat_RP2$t.series$SSB),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,SSB,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,SSB,type="o",col=spcol["RP2"]))
ylim <- range(c(0,rdat_RP$t.series$F.full,rdat_RP2$t.series$F.full),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,F.full,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,F.full,type="o",col=spcol["RP2"]))
ylim <- range(c(0,rdat_RP$t.series$SSB.msst,rdat_RP2$t.series$SSB.msst),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,SSB.msst,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,SSB.msst,type="o",col=spcol["RP2"]))
ylim <- range(c(0,rdat_RP$t.series$F.Fmsy,rdat_RP2$t.series$F.Fmsy),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,F.Fmsy,type="o",col="black",ylim=ylim))
with(rdat_RP2$t.series,points(year,F.Fmsy,type="o",col=spcol["RP2"]))
# Chunk 12
# read in black ses bass age comps used in the recent stock assessment
rdat <- rdat_BlackSeaBass
comp <- rdat$comp.mats # List of composition matrices
acomp <- comp[grepl("^acomp.*.ob$",names(comp))] # list of observed age composition matrices
comp_i <- acomp$acomp.Mcvt.ob
cc_i <- catch_curve(comp_i)
# Plot comps and add catch curves (note the log-tranformation of the composition data)
comp_plot(log(comp_i),cc=cc_i,fillComp = FALSE,ylab= "log(proportion)",xlab="age",title="black sea bass commercial handline catch curves")
# Plot Z estimates over time for multiple sets of age compositions
par(mfrow=c(1,1),mgp=c(1,.2,0),mar=c(2,2,1,1),oma=c(0,0,0,0),tck=0.01)
M <- rdat$parms$M.msst
cc <- lapply(acomp,catch_curve)
abb <- gsub("^(acomp.)|(.ob)$","",names(cc)) # abbreviations of age composition fleets
cols <- rainbow(length(cc))
xlim <- range(unlist(lapply(cc,function(x){as.numeric(x$year)})),na.rm=TRUE)
ylim <- range(c(0,unlist(lapply(cc,function(x){-as.numeric(x$slope)}))),na.rm=TRUE)
for(i in 1:length(cc)){
xi <- cc[[i]]
year <- as.numeric(xi$year)
Z <- -xi$slope
if(i==1){
plot(year,Z,xlim=xlim,ylim=ylim,type="o",col=cols[i])
}else{
points(year,Z,type="o",col=cols[i])
}
}
# Add reference line for natural mortality
abline(h=M,lty=2,lwd=2)
text(par("usr")[1]+0.05*diff(par("usr")[1:2]),M,labels="M",pos=3)
legend("bottomleft",legend=abb,col=cols,pch=1,lty=1,bty="n")
# Chunk 1
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.width = 7,
fig.height = 7,
warning = FALSE,
errors = FALSE,
messages = FALSE
)
# Chunk 2
# Install and load package
#devtools::install_github("nikolaifish/bamExtras")
library(bamExtras)
# Load dependencies
library(stringr)
# see all data objects in bamExtras
data(package="bamExtras")$result[,"Item"]
rdat_BlackSeaBass$parms$styr
rdat_BlackSeaBass$parms$t.series
rdat_BlackSeaBass$t.series
rdat_BlackSeaBass$info$date
?standardize_rdat
par(mfrow=c(3,2),mar=c(2,2,1,1),mgp=c(1,0.2,0),tck=-0.01)
with(rdat_BS$t.series,{
plot(year,N,type="o")
plot(year,recruits,type="o")
plot(year,SSB,type="o")
plot(year,F.full,type="o")
plot(year,SSB.msst,type="o")
plot(year,F.Fmsy,type="o")
})
spcol <- c("BS"="black","RP"="red")
par(mfrow=c(3,2),mar=c(2,2,1,1),mgp=c(1,0.2,0),tck=-0.01)
ylim <- range(c(0,rdat_BS$t.series$N,rdat_RP$t.series$N),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,N,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,N,type="o",col=spcol["RP"]))
legend("top",legend=c("Black Sea Bass","Red Porgy"),
pch=1,col=spcol,lty=1)
ylim <- range(c(0,rdat_BS$t.series$recruits,rdat_RP$t.series$recruits),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,recruits,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,recruits,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$SSB,rdat_RP$t.series$SSB),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,SSB,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,SSB,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$F.full,rdat_RP$t.series$F.full),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,F.full,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,F.full,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$SSB.msst,rdat_RP$t.series$SSB.msst),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,SSB.msst,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,SSB.msst,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$F.Fmsy,rdat_RP$t.series$F.Fmsy),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,F.Fmsy,type="o",col="black",ylim=ylim))
with(rdat_RP$t.series,points(year,F.Fmsy,type="o",col=spcol["RP"]))
bam_RP <- bam2r(dat_obj=dat_RedPorgy,tpl_obj=tpl_RedPorgy,cxx_obj=cxx_RedPorgy)
bam_RP$dat
bam_RP$L_init$selpar_n_yrs_wgted
bam_RP$L_init$set_steep
?bam2r
View(run_bam)
# Run a bam model and assign rdat output to object
rdat_RP <- run_bam(bam=bam_RP,fileName="RP")
L_init2$set_steep
# Modify data input from a BAM model and incorporate it back into the dat file object
L_init2 <- bam_RP$L_init
L_init2$set_steep[c(1,5)] <- paste(0.6) # Change steepness
L_init2$set_steep[4] <- paste(-abs(as.numeric(L_init2$set_steep[4]))) # Fix steepness
bam_RP2 <- bam2r("RedPorgy",L_init_user=L_init2)
rdat_RP2 <- run_bam(bam=bam_RP2,fileName="RP2")
spcol <- c("RP"="black","RP2"="red")
par(mfrow=c(3,2),mar=c(2,2,1,1),mgp=c(1,0.2,0),tck=-0.01)
ylim <- range(c(0,rdat_RP$t.series$N,rdat_RP2$t.series$N),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,N,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,N,type="o",col=spcol["RP2"]))
legend("top",legend=c("Black Sea Bass","Red Porgy"),
pch=1,col=spcol,lty=1)
ylim <- range(c(0,rdat_RP$t.series$recruits,rdat_RP2$t.series$recruits),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,recruits,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,recruits,type="o",col=spcol["RP2"]))
ylim <- range(c(0,rdat_RP$t.series$SSB,rdat_RP2$t.series$SSB),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,SSB,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,SSB,type="o",col=spcol["RP2"]))
ylim <- range(c(0,rdat_RP$t.series$F.full,rdat_RP2$t.series$F.full),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,F.full,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,F.full,type="o",col=spcol["RP2"]))
ylim <- range(c(0,rdat_RP$t.series$SSB.msst,rdat_RP2$t.series$SSB.msst),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,SSB.msst,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,SSB.msst,type="o",col=spcol["RP2"]))
ylim <- range(c(0,rdat_RP$t.series$F.Fmsy,rdat_RP2$t.series$F.Fmsy),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,F.Fmsy,type="o",col="black",ylim=ylim))
with(rdat_RP2$t.series,points(year,F.Fmsy,type="o",col=spcol["RP2"]))
spcol <- c("RP"="black","RP2"="red")
par(mfrow=c(3,2),mar=c(2,2,1,1),mgp=c(1,0.2,0),tck=-0.01)
ylim <- range(c(0,rdat_RP$t.series$N,rdat_RP2$t.series$N),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,N,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,N,type="o",col=spcol["RP2"]))
legend("top",legend=c("Red Porgy","Red Porgy2"),
pch=1,col=spcol,lty=1)
ylim <- range(c(0,rdat_RP$t.series$recruits,rdat_RP2$t.series$recruits),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,recruits,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,recruits,type="o",col=spcol["RP2"]))
ylim <- range(c(0,rdat_RP$t.series$SSB,rdat_RP2$t.series$SSB),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,SSB,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,SSB,type="o",col=spcol["RP2"]))
ylim <- range(c(0,rdat_RP$t.series$F.full,rdat_RP2$t.series$F.full),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,F.full,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,F.full,type="o",col=spcol["RP2"]))
ylim <- range(c(0,rdat_RP$t.series$SSB.msst,rdat_RP2$t.series$SSB.msst),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,SSB.msst,type="o",col=spcol["RP"],ylim=ylim))
with(rdat_RP2$t.series,points(year,SSB.msst,type="o",col=spcol["RP2"]))
ylim <- range(c(0,rdat_RP$t.series$F.Fmsy,rdat_RP2$t.series$F.Fmsy),na.rm=TRUE)
with(rdat_RP$t.series,plot(year,F.Fmsy,type="o",col="black",ylim=ylim))
with(rdat_RP2$t.series,points(year,F.Fmsy,type="o",col=spcol["RP2"]))
# read in black ses bass age comps used in the recent stock assessment
rdat <- rdat_BlackSeaBass
comp <- rdat$comp.mats # List of composition matrices
acomp <- comp[grepl("^acomp.*.ob$",names(comp))] # list of observed age composition matrices
comp_i <- acomp$acomp.Mcvt.ob
cc_i <- catch_curve(comp_i)
# Plot comps and add catch curves (note the log-tranformation of the composition data)
comp_plot(log(comp_i),cc=cc_i,fillComp = FALSE,ylab= "log(proportion)",xlab="age",title="black sea bass commercial handline catch curves")
# Plot Z estimates over time for multiple sets of age compositions
par(mfrow=c(1,1),mgp=c(1,.2,0),mar=c(2,2,1,1),oma=c(0,0,0,0),tck=0.01)
M <- rdat$parms$M.msst
cc <- lapply(acomp,catch_curve)
abb <- gsub("^(acomp.)|(.ob)$","",names(cc)) # abbreviations of age composition fleets
cols <- rainbow(length(cc))
xlim <- range(unlist(lapply(cc,function(x){as.numeric(x$year)})),na.rm=TRUE)
ylim <- range(c(0,unlist(lapply(cc,function(x){-as.numeric(x$slope)}))),na.rm=TRUE)
for(i in 1:length(cc)){
xi <- cc[[i]]
year <- as.numeric(xi$year)
Z <- -xi$slope
if(i==1){
plot(year,Z,xlim=xlim,ylim=ylim,type="o",col=cols[i])
}else{
points(year,Z,type="o",col=cols[i])
}
}
# Add reference line for natural mortality
abline(h=M,lty=2,lwd=2)
text(par("usr")[1]+0.05*diff(par("usr")[1:2]),M,labels="M",pos=3)
legend("bottomleft",legend=abb,col=cols,pch=1,lty=1,bty="n")
?M_calc
# Return all possible estimates based on tmax
M_calc(tmax=11)
# Return all possible estimates based on tmax or K
M_calc(tmax=11,K=0.173)
# Return all possible estimates based on tmax, K, or Linf (in centimeters)
M_calc(tmax=11,Linf=50.2,K=0.173)
# Return just the Hoenig_nls estimate published in Then et al. (2014) based on tmax
M_calc(type="Thn_Hngnls",tmax=11)
run_bam()
?run_bam
?rdat2r
?bam2r
bam_AtMe <- bam2r("AtlanticMenhaden")
run_bam(bam=bam_AtMe,fileName="AtMe")
# Chunk 1
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.width = 7,
fig.height = 7,
warning = FALSE,
errors = FALSE,
messages = FALSE
)
# Chunk 2
# Install and load package
#devtools::install_github("nikolaifish/bamExtras")
library(bamExtras)
# Load dependencies
library(stringr)
# Chunk 3
# see all data objects in bamExtras
data(package="bamExtras")$result[,"Item"]
# Chunk 4
rdat_BS <- standardize_rdat(rdat_BlackSeaBass)
rdat_RP <- standardize_rdat(rdat_RedPorgy)
# Chunk 5
par(mfrow=c(3,2),mar=c(2,2,1,1),mgp=c(1,0.2,0),tck=-0.01)
with(rdat_BS$t.series,{
plot(year,N,type="o")
plot(year,recruits,type="o")
plot(year,SSB,type="o")
plot(year,F.full,type="o")
plot(year,SSB.msst,type="o")
plot(year,F.Fmsy,type="o")
})
# Chunk 6
spcol <- c("BS"="black","RP"="red")
par(mfrow=c(3,2),mar=c(2,2,1,1),mgp=c(1,0.2,0),tck=-0.01)
ylim <- range(c(0,rdat_BS$t.series$N,rdat_RP$t.series$N),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,N,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,N,type="o",col=spcol["RP"]))
legend("top",legend=c("Black Sea Bass","Red Porgy"),
pch=1,col=spcol,lty=1)
ylim <- range(c(0,rdat_BS$t.series$recruits,rdat_RP$t.series$recruits),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,recruits,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,recruits,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$SSB,rdat_RP$t.series$SSB),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,SSB,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,SSB,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$F.full,rdat_RP$t.series$F.full),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,F.full,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,F.full,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$SSB.msst,rdat_RP$t.series$SSB.msst),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,SSB.msst,type="o",col=spcol["BS"],ylim=ylim))
with(rdat_RP$t.series,points(year,SSB.msst,type="o",col=spcol["RP"]))
ylim <- range(c(0,rdat_BS$t.series$F.Fmsy,rdat_RP$t.series$F.Fmsy),na.rm=TRUE)
with(rdat_BS$t.series,plot(year,F.Fmsy,type="o",col="black",ylim=ylim))
with(rdat_RP$t.series,points(year,F.Fmsy,type="o",col=spcol["RP"]))
# Chunk 7
bam_RP <- bam2r(dat_obj=dat_RedPorgy,tpl_obj=tpl_RedPorgy,cxx_obj=cxx_RedPorgy)
# Chunk 8
bam_RP <- bam2r("RedPorgy")
# Chunk 9
# Run a bam model and assign rdat output to object
#rdat_RP <- run_bam(bam=bam_RP,fileName="RP")
# Chunk 10
# Modify data input from a BAM model and incorporate it back into the dat file object
# L_init2 <- bam_RP$L_init
# L_init2$set_steep[c(1,5)] <- paste(0.6) # Change steepness
# L_init2$set_steep[4] <- paste(-abs(as.numeric(L_init2$set_steep[4]))) # Fix steepness
# bam_RP2 <- bam2r("RedPorgy",L_init_user=L_init2)
# rdat_RP2 <- run_bam(bam=bam_RP2,fileName="RP2")
# Chunk 11
# spcol <- c("RP"="black","RP2"="red")
#
# par(mfrow=c(3,2),mar=c(2,2,1,1),mgp=c(1,0.2,0),tck=-0.01)
# ylim <- range(c(0,rdat_RP$t.series$N,rdat_RP2$t.series$N),na.rm=TRUE)
# with(rdat_RP$t.series,plot(year,N,type="o",col=spcol["RP"],ylim=ylim))
# with(rdat_RP2$t.series,points(year,N,type="o",col=spcol["RP2"]))
#
# legend("top",legend=c("Red Porgy","Red Porgy2"),
#        pch=1,col=spcol,lty=1)
#
# ylim <- range(c(0,rdat_RP$t.series$recruits,rdat_RP2$t.series$recruits),na.rm=TRUE)
# with(rdat_RP$t.series,plot(year,recruits,type="o",col=spcol["RP"],ylim=ylim))
# with(rdat_RP2$t.series,points(year,recruits,type="o",col=spcol["RP2"]))
#
# ylim <- range(c(0,rdat_RP$t.series$SSB,rdat_RP2$t.series$SSB),na.rm=TRUE)
# with(rdat_RP$t.series,plot(year,SSB,type="o",col=spcol["RP"],ylim=ylim))
# with(rdat_RP2$t.series,points(year,SSB,type="o",col=spcol["RP2"]))
#
# ylim <- range(c(0,rdat_RP$t.series$F.full,rdat_RP2$t.series$F.full),na.rm=TRUE)
# with(rdat_RP$t.series,plot(year,F.full,type="o",col=spcol["RP"],ylim=ylim))
# with(rdat_RP2$t.series,points(year,F.full,type="o",col=spcol["RP2"]))
#
# ylim <- range(c(0,rdat_RP$t.series$SSB.msst,rdat_RP2$t.series$SSB.msst),na.rm=TRUE)
# with(rdat_RP$t.series,plot(year,SSB.msst,type="o",col=spcol["RP"],ylim=ylim))
# with(rdat_RP2$t.series,points(year,SSB.msst,type="o",col=spcol["RP2"]))
#
# ylim <- range(c(0,rdat_RP$t.series$F.Fmsy,rdat_RP2$t.series$F.Fmsy),na.rm=TRUE)
# with(rdat_RP$t.series,plot(year,F.Fmsy,type="o",col="black",ylim=ylim))
# with(rdat_RP2$t.series,points(year,F.Fmsy,type="o",col=spcol["RP2"]))
# Chunk 12
# read in black ses bass age comps used in the recent stock assessment
rdat <- rdat_BlackSeaBass
comp <- rdat$comp.mats # List of composition matrices
acomp <- comp[grepl("^acomp.*.ob$",names(comp))] # list of observed age composition matrices
comp_i <- acomp$acomp.Mcvt.ob
cc_i <- catch_curve(comp_i)
# Plot comps and add catch curves (note the log-tranformation of the composition data)
comp_plot(log(comp_i),cc=cc_i,fillComp = FALSE,ylab= "log(proportion)",xlab="age",title="black sea bass commercial handline catch curves")
# Plot Z estimates over time for multiple sets of age compositions
par(mfrow=c(1,1),mgp=c(1,.2,0),mar=c(2,2,1,1),oma=c(0,0,0,0),tck=0.01)
M <- rdat$parms$M.msst
cc <- lapply(acomp,catch_curve)
abb <- gsub("^(acomp.)|(.ob)$","",names(cc)) # abbreviations of age composition fleets
cols <- rainbow(length(cc))
xlim <- range(unlist(lapply(cc,function(x){as.numeric(x$year)})),na.rm=TRUE)
ylim <- range(c(0,unlist(lapply(cc,function(x){-as.numeric(x$slope)}))),na.rm=TRUE)
for(i in 1:length(cc)){
xi <- cc[[i]]
year <- as.numeric(xi$year)
Z <- -xi$slope
if(i==1){
plot(year,Z,xlim=xlim,ylim=ylim,type="o",col=cols[i])
}else{
points(year,Z,type="o",col=cols[i])
}
}
# Add reference line for natural mortality
abline(h=M,lty=2,lwd=2)
text(par("usr")[1]+0.05*diff(par("usr")[1:2]),M,labels="M",pos=3)
legend("bottomleft",legend=abb,col=cols,pch=1,lty=1,bty="n")
